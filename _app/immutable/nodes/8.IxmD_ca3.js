import{a as b,t as k,c as Ve}from"../chunks/D8IZ5tij.js";import{aH as Te,aI as Ge,aJ as We,o as He,x as se,G as Je,N as Ke,q as Qe,y as Xe,aa as Ze,aE as Ie,au as Ye,P as je,g as $e,p as ne,c,r as v,t as N,a as oe,f as le,ac as T,b as Ee,s as _,i as t,a8 as d,aK as xe,aL as et,l as M}from"../chunks/DRP5GfAB.js";import{l as Fe,s as H,d as tt,e as Se,a as at}from"../chunks/DcfRItNb.js";import{e as rt,i as st}from"../chunks/Duy6D2ej.js";import{s as J,r as ke}from"../chunks/KYYcMl7V.js";import{i as lt,p as O}from"../chunks/DlRuioKL.js";import{p as V,i as U}from"../chunks/kFZv4Qm8.js";import{t as Y}from"../chunks/Bvena8yX.js";import{r as nt}from"../chunks/BfgKyPlE.js";import{a as ot}from"../chunks/xSQF6w4t.js";import{s as it}from"../chunks/DzRVWYVD.js";function De(a,e,s){se&&Je();var o=a,n=Ze,r,l=Te()?Ge:We;He(()=>{l(n,n=e())&&(r&&Ke(r),r=Qe(()=>s(o)))}),se&&(o=Xe)}function fe(a,e,s=e){var o=Te();Fe(a,"input",n=>{var r=n?a.defaultValue:a.value;if(r=_e(a)?he(r):r,s(r),o&&r!==(r=e())){var l=a.selectionStart,m=a.selectionEnd;a.value=r??"",m!==null&&(a.selectionStart=l,a.selectionEnd=Math.min(m,a.value.length))}}),(se&&a.defaultValue!==a.value||$e(e)==null&&a.value)&&s(_e(a)?he(a.value):a.value),Ie(()=>{var n=e();_e(a)&&n===he(a.value)||a.type==="date"&&!n&&!a.value||n!==a.value&&(a.value=n??"")})}const me=new Set;function vt(a,e,s,o,n=o){var r=s.getAttribute("type")==="checkbox",l=a;let m=!1;if(e!==null)for(var f of e)l=l[f]??(l[f]=[]);l.push(s),Fe(s,"change",()=>{var i=s.__value;r&&(i=pe(l,i,s.checked)),n(i)},()=>n(r?[]:null)),Ie(()=>{var i=o();if(se&&s.defaultChecked!==s.checked){m=!0;return}r?(i=i||[],s.checked=i.includes(s.__value)):s.checked=lt(s.__value,i)}),Ye(()=>{var i=l.indexOf(s);i!==-1&&l.splice(i,1)}),me.has(l)||(me.add(l),je(()=>{l.sort((i,g)=>i.compareDocumentPosition(g)===4?-1:1),me.delete(l)})),je(()=>{if(m){var i;if(r)i=pe(l,i,s.checked);else{var g=l.find(h=>h.checked);i=g==null?void 0:g.__value}n(i)}})}function pe(a,e,s){for(var o=new Set,n=0;n<a.length;n+=1)a[n].checked&&o.add(a[n].__value);return s||o.delete(e),Array.from(o)}function _e(a){var e=a.type;return e==="number"||e==="range"}function he(a){return a===""?null:+a}var ct=k('<div style="aspect-ratio: 1/1; display: inline-block;"><div class="backing svelte-efxvsm"><div><!></div></div></div>');function dt(a,e){ne(e,!0);let s=V(e,"borderRadius",3,"10px"),o=V(e,"progress",7,0),n=V(e,"color",3,"rgb(153, 86, 86)"),r=V(e,"extraPadding",3,"18px");o(Math.max(1,o()));var l=ct(),m=c(l),f=c(m),i=c(f);{var g=h=>{var w=Ve(),q=le(w);it(q,()=>e.children),b(h,w)};U(i,h=>{e.children&&h(g)})}v(f),v(m),v(l),N(()=>J(m,"style",`--ring-width: ${s()??""}; --progress: ${o()??""}%; --ring-color: ${n()??""}; --extra-padding: ${r()??""};`)),b(a,l),oe()}var ut=k('<span class="points-change svelte-15n4znc"> </span>'),ft=k('<!> <span class="points svelte-15n4znc"> </span>',1),mt=k('<span class="point-view svelte-15n4znc">ðŸª™ <!></span>');function Ne(a,e){ne(e,!0);let s=e.amount==null,o=T(0),n=T(O(e.amount));Ee(()=>{e.amount!=t(n)&&(d(o,e.amount-t(n)),d(n,O(e.amount)))});var r=mt(),l=_(c(r));De(l,()=>e.amount,m=>{var f=ft(),i=le(f);{var g=q=>{var y=ut(),G=c(y);v(y),N(I=>{J(y,"style",`color: ${(t(o)>=0?"#0F0":"#F00")??""};`),H(G,`${(t(o)>0?"+":"-")??""}${I??""}`)},[()=>Math.abs(t(o))]),b(q,y)};U(i,q=>{t(o)!=0&&q(g)})}var h=_(i,2),w=c(h,!0);v(h),N(()=>H(w,e.amount)),b(m,f)}),v(r),N(()=>{Y(r,"hide-first",s),Y(r,"hide-first-reveal",e.amount!=null&&s)}),b(a,r),oe()}var _t=k('<textarea id="timer-name-edit" class="svelte-1qw7jss"></textarea>'),ht=k('<span style="font-style: italic; color: #bbbE;" class="svelte-1qw7jss"> </span>'),bt=k('<div class="svelte-1qw7jss"><div class="center-hz svelte-1qw7jss" style="color: #bbbE;"> </div> <h1 class="timer-text center-hz svelte-1qw7jss"> </h1> <div class="timer-task center-vt svelte-1qw7jss"><div class="center-hz svelte-1qw7jss"><!></div></div></div>'),kt=(a,e)=>e(!1,!0),gt=k('<button class="btn btn-secondary svelte-1qw7jss" aria-label="finish current task"><i class="bi bi-check-circle svelte-1qw7jss"></i></button>'),wt=(a,e)=>confirm("Quit timer without cashing out?")?e(!0,!1):null,qt=k('<button class="btn btn-danger svelte-1qw7jss" aria-label="resume"><i class="bi bi-play-fill svelte-1qw7jss"></i></button>'),yt=k('<button class="btn btn-secondary svelte-1qw7jss" aria-label="pause"><i class="bi bi-pause-fill svelte-1qw7jss"></i></button>'),jt=k('<div class="appear svelte-1qw7jss"><!> <div class="timer-btns center-hz appear mt-3 svelte-1qw7jss"><button id="cashout-btn" class="btn btn-secondary svelte-1qw7jss">Cash Out <!></button> <!> <button class="btn btn-secondary svelte-1qw7jss" aria-label="quit timer without cashing out points"><i class="bi bi-x-circle svelte-1qw7jss"></i></button> <!></div></div>'),xt=k('<div class="form-group svelte-1qw7jss"><label class="svelte-1qw7jss">What would you like to work on? <input class="form-control svelte-1qw7jss" placeholder="Set task name"></label></div>'),St=k('<div class="center-vt svelte-1qw7jss"><div class="form-group svelte-1qw7jss"><label class="svelte-1qw7jss">Duration: <input class="form-control svelte-1qw7jss" type="number" min="1" max="50"></label></div> <!> <button class="btn btn-primary mt-4 svelte-1qw7jss">Start</button></div>'),pt=k('<div class="center-hz svelte-1qw7jss"><div class="center-vt svelte-1qw7jss"><div class="center-hz svelte-1qw7jss"></div> <div class="center-hz svelte-1qw7jss"><!></div></div></div>');function Tt(a,e){ne(e,!0);let s=V(e,"taskName",15,void 0),o=V(e,"onFinish",3,void 0),n=V(e,"onTaskFinish",3,void 0),r=T(!1),l=T(!1),m=T(O(e.mode.length)),f=M(()=>t(m)*60),i=T(O(new Date)),g=T(void 0),h=T(0),w=T(0),q=M(()=>t(h)+t(w)),y=M(()=>t(f)-t(q)),G=M(()=>Math.floor(Math.abs(t(y))/60)%60),I=M(()=>Math.round(Math.abs(t(y)))%60),E=M(()=>new Date(t(i).getTime()+(t(f)-t(w))*1e3)),j=M(()=>Math.min(100,Math.round(t(q)/t(f)*100))),F=[10,5,2,1,0];for(;F[0]>=e.mode.length;)F=F.slice(1);function K(u,S,x="pomodoroUpdate"){if((Notification==null?void 0:Notification.permission)==="granted"){let A={body:S,img:""};x!=null&&(A.tag=x),new Notification(u,A)}}function P(){d(h,(new Date-t(i))/1e3),t(y)<F[0]*60&&(t(y)<0&&F[0]==0?K("Pomodoro","Finished. Good job!"):K("Pomodoro",`${(t(y)/60).toFixed(2)} minutes remaining.`),F=F.slice(1))}function W(){Notification.requestPermission().then(u=>{}),d(r,!0),d(l,!1),t(h)!=0&&(d(w,t(w)+t(h)),d(h,0)),d(i,O(new Date)),P(),d(g,O(setInterval(P,1e3)))}function L(u=!1,S=!1){let x=t(q)/60;o()(x,u?0:e.mode.calcScore(x,t(m)),S),d(r,!1),d(l,!1),clearInterval(t(g)),d(h,0),d(w,0)}function $(){d(l,!0),clearInterval(t(g))}ot(()=>{t(r)&&L(!1,!1)});function ee(){n()(s()),document.getElementById("timer-name-edit").select()}var Q=pt();Se("keydown",xe,u=>{u.key=="Escape"&&document.activeElement==document.getElementById("timer-name-edit")&&document.activeElement.blur(),t(r)&&!["INPUT","TEXTAREA"].includes(document.activeElement.tagName)&&(u.key==" "?(t(l)?W():$(),u.preventDefault()):u.key=="f"&&s()!=null&&confirm("Finish task: "+s())&&(ee(),u.preventDefault()))}),Se("beforeunload",xe,u=>{t(r)&&(u.preventDefault(),u.returnValue=!0)}),at(u=>{N((S,x)=>et.title=`${S??""}:${x??""} - Pomodoro`,[()=>t(G).toString().padStart(2,"0"),()=>t(I).toString().padStart(2,"0")])});var ge=c(Q),we=_(c(ge),2),Pe=c(we);{var ze=u=>{var S=jt(),x=c(S);dt(x,{get progress(){return t(j)},get color(){return e.mode.color},children:(p,z)=>{var ce=bt(),de=c(ce),Ce=c(de,!0);v(de);var re=_(de,2),Be=c(re);v(re);var qe=_(re,2),ye=c(qe),Oe=c(ye);{var Re=B=>{var D=_t();nt(D),N(()=>J(D,"placeholder",e.mode.name)),fe(D,s),b(B,D)},Ue=B=>{var D=ht(),ue=c(D,!0);v(D),N(()=>H(ue,e.mode.name)),b(B,D)};U(Oe,B=>{e.mode.hasTask?B(Re):B(Ue,!1)})}v(ye),v(qe),v(ce),N((B,D,ue)=>{H(Ce,B),Y(re,"paused",t(l)),H(Be,`${D??""}:${ue??""}`)},[()=>t(E).toLocaleTimeString(),()=>t(G).toString().padStart(2,"0"),()=>t(I).toString().padStart(2,"0")]),b(p,ce)},$$slots:{default:!0}});var A=_(x,2),R=c(A);R.__click=[kt,L];var te=_(c(R));const ie=M(()=>e.mode.calcScore(t(q)/60,t(m)));var ve=M(()=>t(ie));Ne(te,{get amount(){return t(ve)}}),v(R);var C=_(R,2);{var X=p=>{var z=gt();z.__click=ee,b(p,z)};U(C,p=>{e.mode.hasTask&&p(X)})}var Z=_(C,2);Z.__click=[wt,L];var ae=_(Z,2);{var Le=p=>{var z=qt();z.__click=W,b(p,z)},Ae=p=>{var z=yt();z.__click=$,b(p,z)};U(ae,p=>{t(l)?p(Le):p(Ae,!1)})}v(A),v(S),b(u,S)},Me=u=>{var S=St(),x=c(S),A=c(x),R=_(c(A));ke(R),v(A),v(x);var te=_(x,2);{var ie=C=>{var X=xt(),Z=c(X),ae=_(c(Z));ke(ae),v(Z),v(X),fe(ae,s),b(C,X)};U(te,C=>{e.mode.hasTask&&C(ie)})}var ve=_(te,2);ve.__click=W,v(S),fe(R,()=>t(m),C=>d(m,C)),b(u,S)};U(Pe,u=>{t(r)?u(ze):u(Me,!1)})}v(we),v(ge),v(Q),N(()=>{Y(Q,"overDone",t(y)<0),Y(Q,"almostDone",t(y)<60)}),b(a,Q),oe()}tt(["click"]);class be{constructor({name:e,length:s,color:o,reward:n,hasTask:r=!1}){this.name=e,this.length=s,this.color=o,this.reward=n,this.hasTask=r}calcScore(e,s){let o=5;if(e<.1)return 0;let n=e>s?Math.min(1,s/this.length):e<this.length?e/this.length:1,r=e>s?Math.pow((e-s)/o,2):0;return Math.max(0,Math.round((n-r)*this.reward))}}var It=k('<input type="radio" class="btn-check" autocomplete="off"> <label class="btn btn-outline radio-btn svelte-1w7m3ok"> </label>',1),Et=k('<br> <br>  <div class="menu-bar mb-3 svelte-1w7m3ok"><div></div> <div class="btn-group" role="group" aria-label="Pomodoro Mode Selector"></div> <!></div> <!>',1);function Rt(a,e){ne(e,!0);const s=[],o={work:new be({name:"Work",length:25,color:"#ab5744",reward:1e3,hasTask:!0}),break:new be({name:"Break",length:5,color:"#4d82ab",reward:300}),longbreak:new be({name:"Long Break",length:10,color:"#237047",reward:450})};let n=T(""),r=T("work"),l=0;function m(I,E){{let j=parseInt(localStorage.getItem("points"));j&&(E=parseInt(j))}return E}let f=T(O(m("points",0)));Ee(()=>{localStorage.setItem("points",t(f))});function i(I,E,j){d(f,t(f)+E),j&&(t(r)=="work"?(l+=I,l>=o.work.length*3.4?(l=0,d(r,"longbreak")):d(r,"break")):d(r,"work"))}function g(){d(f,t(f)+1e3)}var h=Et(),w=_(le(h),4),q=_(c(w),2);rt(q,21,()=>Object.entries(o),st,(I,E)=>{let j=()=>t(E)[0],F=()=>t(E)[1];var K=It(),P=le(K);ke(P);var W,L=_(P,2),$=c(L,!0);v(L),N(()=>{J(P,"id",`radio-${j()}`),W!==(W=j())&&(P.value=(P.__value=j())==null?"":j()),J(L,"for",`radio-${j()}`),J(L,"style",t(r)==j()?`background-color: ${F().color};`:""),H($,F().name)}),vt(s,[],P,()=>(j(),t(r)),ee=>d(r,ee)),b(I,K)}),v(q);var y=_(q,2);Ne(y,{get amount(){return t(f)}}),v(w);var G=_(w,2);De(G,()=>t(r),I=>{Tt(I,{get mode(){return o[t(r)]},onFinish:i,onTaskFinish:g,get taskName(){return t(n)},set taskName(E){d(n,O(E))}})}),b(a,h),oe()}export{Rt as component};
